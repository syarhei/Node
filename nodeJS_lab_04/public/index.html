<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="http://code.jquery.com/jquery-1.8.3.js"></script>
    <title>nodeJS_lab_04</title>
</head>

<style type = "text/css">
    table {
        margin-top: 10px;
        background-color: khaki;
        border : 2px solid black;
        font-size: 22pt;
        width: 800px;
    }
    td {
        border : 2px solid  black;
    }
    input {
        margin-right: 2px;
        margin-top: 30px;
        width: 350px;
        height: 30px;
        font-size: 20px;
    }
    select {
        margin-right: 2px;
        margin-top: 30px;
        width: 265px;
        height: 30px;
        font-size: 14px;
    }
    button {
        margin-right: 2px;
        margin-top: 30px;
        width: 150px;
        height: 30px;
        font-size: 16px;
    }
</style>

<body>

<center>
    <input id="search">
    <select id="type_search">
        <option>по имени альбома</option>
        <option>по имени артиста</option>
        <option>по имени песни</option>
        <option>по имени альбома и артиста (all)</option>
        <option>по имени альбома и артиста (join)</option>
        <option>по имени альбома или артиста (any)</option>
        <option>по имени альбома и песни (props)</option>
        <option>по всем параметрам (some)</option>
        <option>по имени альбома (цепочка)</option>
    </select>
    <button onclick="search()">Поиск</button>
    <br>
    <table id="tbl">
        <tr align='center'>
            <td><b> Name </b></td>
            <td><b> Type </b></td>
        </tr>
    </table>
    <div id = "time"></div>
</center>

<script type="text/javascript">
    
    function typeSearch() {
        var message = document.getElementById("type_search").value;
        switch (message) {
            case "по имени альбома" : message = "album"; break;
            case "по имени артиста" : message = "artist"; break;
            case "по имени песни" : message = "track"; break;
            case "по имени альбома и артиста (all)" : message = "album_plus_artist"; break;
            case "по имени альбома или артиста (any)" : message = "album_or_artist"; break;
            case "по имени альбома и песни (props)" : message = "album_plus_track"; break;
            case "по всем параметрам (some)" : message = "all"; break;
            case "по имени альбома и артиста (join)" : message = "join"; break;
            case "по имени альбома (цепочка)" : message = "chain"; break;
        }
        return message;
    }

    function search(message) {
        message = typeSearch();
        $.ajax({
            type: 'get',
            url: '/search',
            data: {'text' : document.getElementById('search').value, 'type' : message},
            success: function (data) {
                if (data.substr(0,5) == "Error") alert(data);
                else if (message == "album_plus_artist") refreshSome(data);
                else if (message == "album_plus_track") refreshSome(data);
                else if (message == "all") refreshSome(data);
                else if (message == "join") refreshSome(data);
                else refresh(data);
            }
        });
    }

    function refresh(data) {
        $("#tbl tr").remove();
        $("#tbl").append("<tr align='center'><td><b> Name </b></td> <td><b> Type </b></td></tr>");
        data = JSON.parse(data);
        document.getElementById("time").innerText = "milliseconds: " + data[0];
        for (var i = 0; i < data[1].items.length; i++) {
            $("#tbl").append("<tr>" +
                    "<td>" + data[1].items[i].name + "</td>" +
                    "<td>" + data[1].items[i].type + "</td>" +
                    "</tr>")
        }
    }

    function refreshSome(data) {
        $("#tbl tr").remove();
        $("#tbl").append("<tr align='center'><td><b> Name </b></td> <td><b> Type </b></td></tr>");
        data = JSON.parse(data);
        document.getElementById("time").innerText = "milliseconds: " + data[0];
        for (var i = 0; i < data[1].items.length; i++) {
            $("#tbl").append("<tr>" +
                    "<td>" + data[1].items[i].name + "</td>" +
                    "<td>" + data[1].items[i].type + "</td>" +
                    "</tr>")
        }
        for (var i = 0; i < data[2].items.length; i++) {
            $("#tbl").append("<tr>" +
                    "<td>" + data[2].items[i].name + "</td>" +
                    "<td>" + data[2].items[i].type + "</td>" +
                    "</tr>")
        }
    }

</script>

</body>
</html>